name: Deploy Container
on:
  push:
    branches: [ "main" ]
    paths:
      - scripts/app/*
      - scripts/app/*/*
      - scripts/app/*/*/*
  workflow_dispatch:
permissions:
  id-token: write
  contents: read
jobs:
  deploy:
    name: Deploy
    runs-on: ubuntu-latest
    environment: production
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: get latest data
        uses: ./.github/actions/get_data_from_db
        with:
          awsRole: ${{ secrets.AWS_ROLE }}
          awsRegion: ${{ secrets.MY_AWS_REGION }}
      - name: deploy container
        uses: ./.github/actions/deploy_ecr_image
        with:
          ECR_REPOSITORY: ${{ secrets.ECR_NAME }}
          ECS_SERVICE: ${{ secrets.ECR_SERVICE_NAME }}
          ECS_CLUSTER: ${{ secrets.ECR_CLUSTER_NAME }}
          CONTAINER_NAME: ${{ secrets.ECR_CONTAINER_NAME }}
          awsRole: ${{ secrets.AWS_ROLE }}
          awsRegion: ${{ secrets.MY_AWS_REGION }}